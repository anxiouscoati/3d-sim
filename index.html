<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prototype Catalog – Image / 3D</title>

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root{
      --page-bg:#F7F7F7;
      --card-bg:#ffffff;
      --text:#0f0f0f;
      --muted:rgba(15,15,15,.65);

      --ui-bg:#F7F7F7;      /* фон кнопок + активный таб */
      --ui-border:rgba(0,0,0,.08);

      --tab-inactive-text:#111;
      --tab-active-text:#111;

      --radius:18px;
      --shadow: 0 14px 40px rgba(0,0,0,.08);
      --shadow-hover: 0 22px 60px rgba(0,0,0,.12);

      --btn-red:#ff3346;
      --btn-red-hover:#e62e3f;

      --font:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--font);
      background:var(--page-bg);
      color:var(--text);
      padding:28px 16px 64px;
    }
    .wrap{ max-width:1160px; margin:0 auto; }

    /* Section */
    .series{
      background:var(--page-bg);
      margin:0 0 28px;
    }
    .seriesHeader{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
      margin: 10px 0 14px;
    }
    .seriesTitle{
      margin:0;
      font-size:18px;
      font-weight:800;
      letter-spacing:-0.01em;
    }
    .seriesSub{
      margin:0;
      font-size:13px;
      color:var(--muted);
    }

    /* Grids */
    .cardsGrid{
      display:grid;
      gap:24px;
    }
    .cardsGrid--racer{ grid-template-columns: repeat(2, minmax(0, 1fr)); } /* 3 cards => 2 rows */
    .cardsGrid--two{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .cardsGrid--one{ grid-template-columns: 1fr; padding: 0 8px; }

    @media (max-width: 900px){
      .cardsGrid--racer, .cardsGrid--two { grid-template-columns: 1fr; }
      .cardsGrid--one { padding: 0; }
    }

    /* Mobile carousel only where data-mobile="carousel" */
    @media (max-width: 900px){
      .cardsGrid[data-mobile="carousel"]{
        display:flex;
        overflow-x:auto;
        gap:16px;
        padding: 6px 2px 12px;
        scroll-snap-type:x mandatory;
        -webkit-overflow-scrolling: touch;
      }
      .cardsGrid[data-mobile="carousel"] > .card{
        flex: 0 0 92%;
        scroll-snap-align:center;
      }
    }

    /* Card */
    .card{
      background:var(--card-bg);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:var(--shadow);
      transition:box-shadow .25s ease, transform .08s ease;
    }
    .card:hover{ box-shadow:var(--shadow-hover); }
    .card:active{ transform: translateY(1px); }

    /* Tabs */
    .tabsRow{
      width:100%;
      display:flex;
      justify-content:center;
      padding:14px 12px 6px;
    }
    .tabs{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .tabBtn{
      border:0;
      background:transparent;
      cursor:pointer;
      padding: 10px 16px;
      border-radius: 12px;
      font-size:14px;
      letter-spacing: -0.15px;
      font-weight: 500;
      color: var(--tab-inactive-text);
      transition: background .15s ease, box-shadow .15s ease;
    }
    .tabBtn.active{
      background: var(--ui-bg);   /* активный таб серый */
      box-shadow: 0 10px 18px rgba(0,0,0,.08);
      color: var(--tab-active-text);
    }

    /* Media */
    .media{
      width:100%;
      aspect-ratio: 561 / 397;
      position:relative;
    }
    .pane{
      position:absolute;
      inset:0;
      display:none;
    }
    .pane.active{ display:block; }

    .mediaInner{
      width:100%;
      height:100%;
      position:relative;
      background:transparent;
    }
    img.hero{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      padding:16px;
      background:transparent;
    }
    model-viewer{
      width:100%;
      height:100%;
      display:block;
      background:transparent;
      touch-action:none;
    }

    /* Hand icon */
    .handHint{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-55%);
      pointer-events:none;
      opacity:0;
      transition:opacity .25s ease, transform .25s ease;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,0.18));
    }
    .handHint.show{
      opacity:.9;
      transform:translate(-50%,-55%) scale(1);
    }
    .handHint.hide{
      opacity:0;
      transform:translate(-50%,-55%) scale(.98);
    }
    .handHint svg{
      width:64px;
      height:64px;
      opacity:.95;
      animation: hintWiggle 1.8s ease-in-out infinite;
    }
    @keyframes hintWiggle{
      0%{ transform: rotate(-8deg) translateX(-6px); opacity:.65; }
      50%{ transform: rotate( 8deg) translateX( 6px); opacity:.95; }
      100%{transform: rotate(-8deg) translateX(-6px); opacity:.65; }
    }

    /* Content */
    .content{
      padding: 10px 16px 18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .title{
      margin: 6px 0 0;
      text-align:center;
      font-weight:700;
      font-size:24px;
      line-height:32px;
      letter-spacing:-0.02em;
    }
    .specs{
      display:flex;
      gap:18px;
      justify-content:center;
      flex-wrap:wrap;
      font-size:14px;
      color:var(--text);
    }
    .specs b{ font-weight:600; }
    .specs span{ font-weight:400; color:rgba(15,15,15,.75); }

    .btnRow{
      display:flex;
      gap:12px;
      align-items:stretch;
    }
    .btn{
      flex:1;
      border:1px solid var(--ui-border);
      border-radius:12px;
      padding:12px 14px;
      font-weight:600;
      cursor:pointer;
      background: var(--ui-bg);  /* серые кнопки */
      color: #111;
      transition: box-shadow .15s ease, transform .08s ease, background .15s ease;
    }
    .btn:hover{ box-shadow: 0 10px 18px rgba(0,0,0,.10); }
    .btn:active{ transform: translateY(1px); }

    .btnPrimary{
      flex:1.15;
      background: var(--btn-red);
      color:#fff;
      border:none;
    }
    .btnPrimary:hover{ background: var(--btn-red-hover); }

    @media (max-width: 640px){
      .media{ aspect-ratio: 1 / 1; }
      .handHint svg{ width:56px; height:56px; }
      .btnRow{ flex-direction:column; }
      .btnPrimary{ flex:1; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- Racer Series: 3 cards, desktop 2-up, mobile carousel -->
    <section class="series">
      <div class="seriesHeader">
        <div>
          <h2 class="seriesTitle">Racer Series</h2>
          <p class="seriesSub">3 cards · desktop 2-up · mobile carousel</p>
        </div>
      </div>

      <div class="cardsGrid cardsGrid--racer" data-mobile="carousel">
        <div class="card product-card" data-title="Racer One" data-image="./image.png" data-glb="./PresidentLux_Test2.glb">
          <!-- CARD INNER -->
          <div class="tabsRow">
            <div class="tabs" role="tablist" aria-label="Media tabs">
              <button class="tabBtn active" type="button" data-tab="image" aria-selected="true">Image</button>
              <button class="tabBtn" type="button" data-tab="3d" aria-selected="false">3D View</button>
            </div>
          </div>

          <div class="media">
            <div class="pane active" data-pane="image" role="tabpanel">
              <div class="mediaInner">
                <img class="hero" alt="Product image" />
              </div>
            </div>

            <div class="pane" data-pane="3d" role="tabpanel">
              <div class="mediaInner">
                <model-viewer
                  class="mv"
                  camera-controls
                  disable-pan
                  interaction-prompt="none"
                  loading="eager"
                  reveal="auto"
                  exposure="1"
                  field-of-view="30deg"
                ></model-viewer>

                <div class="handHint show" aria-hidden="true">
                  <svg viewBox="0 0 64 64" fill="none">
                    <path d="M26 30V18c0-3 2-5 5-5s5 2 5 5v12" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M36 30V22c0-3 2-5 5-5s5 2 5 5v16c0 9-7 16-16 16s-16-7-16-16v-6"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M22 33l-4-4c-2-2-5-2-7 0s-2 5 0 7l11 11"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 20c4-6 11-10 22-10s18 4 22 10" stroke="#111" stroke-opacity=".25" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="content">
            <div class="title js-title">Racer One</div>
            <div class="specs">
              <div><b>Platform</b> <span>3.05m / 10’</span></div>
              <div><b>Power</b> <span>2.2kW / 3HP</span></div>
            </div>
            <div class="btnRow">
              <button class="btn" type="button">CAD</button>
              <button class="btn" type="button">Spec</button>
              <button class="btn btnPrimary" type="button">Build your quote</button>
            </div>
          </div>
        </div>

        <div class="card product-card" data-title="Racer Two" data-image="./image.png" data-glb="./PresidentLux_Test2.glb">
          <div class="tabsRow">
            <div class="tabs" role="tablist" aria-label="Media tabs">
              <button class="tabBtn active" type="button" data-tab="image" aria-selected="true">Image</button>
              <button class="tabBtn" type="button" data-tab="3d" aria-selected="false">3D View</button>
            </div>
          </div>

          <div class="media">
            <div class="pane active" data-pane="image" role="tabpanel">
              <div class="mediaInner">
                <img class="hero" alt="Product image" />
              </div>
            </div>

            <div class="pane" data-pane="3d" role="tabpanel">
              <div class="mediaInner">
                <model-viewer
                  class="mv"
                  camera-controls
                  disable-pan
                  interaction-prompt="none"
                  loading="eager"
                  reveal="auto"
                  exposure="1"
                  field-of-view="30deg"
                ></model-viewer>

                <div class="handHint show" aria-hidden="true">
                  <svg viewBox="0 0 64 64" fill="none">
                    <path d="M26 30V18c0-3 2-5 5-5s5 2 5 5v12" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M36 30V22c0-3 2-5 5-5s5 2 5 5v16c0 9-7 16-16 16s-16-7-16-16v-6"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M22 33l-4-4c-2-2-5-2-7 0s-2 5 0 7l11 11"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 20c4-6 11-10 22-10s18 4 22 10" stroke="#111" stroke-opacity=".25" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="content">
            <div class="title js-title">Racer Two</div>
            <div class="specs">
              <div><b>Platform</b> <span>3.05m / 10’</span></div>
              <div><b>Power</b> <span>2.2kW / 3HP</span></div>
            </div>
            <div class="btnRow">
              <button class="btn" type="button">CAD</button>
              <button class="btn" type="button">Spec</button>
              <button class="btn btnPrimary" type="button">Build your quote</button>
            </div>
          </div>
        </div>

        <div class="card product-card" data-title="Racer Three" data-image="./image.png" data-glb="./PresidentLux_Test2.glb">
          <div class="tabsRow">
            <div class="tabs" role="tablist" aria-label="Media tabs">
              <button class="tabBtn active" type="button" data-tab="image" aria-selected="true">Image</button>
              <button class="tabBtn" type="button" data-tab="3d" aria-selected="false">3D View</button>
            </div>
          </div>

          <div class="media">
            <div class="pane active" data-pane="image" role="tabpanel">
              <div class="mediaInner">
                <img class="hero" alt="Product image" />
              </div>
            </div>

            <div class="pane" data-pane="3d" role="tabpanel">
              <div class="mediaInner">
                <model-viewer
                  class="mv"
                  camera-controls
                  disable-pan
                  interaction-prompt="none"
                  loading="eager"
                  reveal="auto"
                  exposure="1"
                  field-of-view="30deg"
                ></model-viewer>

                <div class="handHint show" aria-hidden="true">
                  <svg viewBox="0 0 64 64" fill="none">
                    <path d="M26 30V18c0-3 2-5 5-5s5 2 5 5v12" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M36 30V22c0-3 2-5 5-5s5 2 5 5v16c0 9-7 16-16 16s-16-7-16-16v-6"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M22 33l-4-4c-2-2-5-2-7 0s-2 5 0 7l11 11"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 20c4-6 11-10 22-10s18 4 22 10" stroke="#111" stroke-opacity=".25" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="content">
            <div class="title js-title">Racer Three</div>
            <div class="specs">
              <div><b>Platform</b> <span>3.05m / 10’</span></div>
              <div><b>Power</b> <span>2.2kW / 3HP</span></div>
            </div>
            <div class="btnRow">
              <button class="btn" type="button">CAD</button>
              <button class="btn" type="button">Spec</button>
              <button class="btn btnPrimary" type="button">Build your quote</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- President Series: 2 cards, desktop 2-up -->
    <section class="series">
      <div class="seriesHeader">
        <div>
          <h2 class="seriesTitle">President Series</h2>
          <p class="seriesSub">2 cards · 2-up layout</p>
        </div>
      </div>

      <div class="cardsGrid cardsGrid--two">
        <div class="card product-card" data-title="President One" data-image="./image.png" data-glb="./PresidentLux_Test2.glb">
          <div class="tabsRow">
            <div class="tabs" role="tablist" aria-label="Media tabs">
              <button class="tabBtn active" type="button" data-tab="image" aria-selected="true">Image</button>
              <button class="tabBtn" type="button" data-tab="3d" aria-selected="false">3D View</button>
            </div>
          </div>

          <div class="media">
            <div class="pane active" data-pane="image" role="tabpanel">
              <div class="mediaInner">
                <img class="hero" alt="Product image" />
              </div>
            </div>

            <div class="pane" data-pane="3d" role="tabpanel">
              <div class="mediaInner">
                <model-viewer
                  class="mv"
                  camera-controls
                  disable-pan
                  interaction-prompt="none"
                  loading="eager"
                  reveal="auto"
                  exposure="1"
                  field-of-view="30deg"
                ></model-viewer>

                <div class="handHint show" aria-hidden="true">
                  <svg viewBox="0 0 64 64" fill="none">
                    <path d="M26 30V18c0-3 2-5 5-5s5 2 5 5v12" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M36 30V22c0-3 2-5 5-5s5 2 5 5v16c0 9-7 16-16 16s-16-7-16-16v-6"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M22 33l-4-4c-2-2-5-2-7 0s-2 5 0 7l11 11"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 20c4-6 11-10 22-10s18 4 22 10" stroke="#111" stroke-opacity=".25" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="content">
            <div class="title js-title">President One</div>
            <div class="specs">
              <div><b>Platform</b> <span>3.05m / 10’</span></div>
              <div><b>Power</b> <span>2.2kW / 3HP</span></div>
            </div>
            <div class="btnRow">
              <button class="btn" type="button">CAD</button>
              <button class="btn" type="button">Spec</button>
              <button class="btn btnPrimary" type="button">Build your quote</button>
            </div>
          </div>
        </div>

        <div class="card product-card" data-title="President Two" data-image="./image.png" data-glb="./PresidentLux_Test2.glb">
          <div class="tabsRow">
            <div class="tabs" role="tablist" aria-label="Media tabs">
              <button class="tabBtn active" type="button" data-tab="image" aria-selected="true">Image</button>
              <button class="tabBtn" type="button" data-tab="3d" aria-selected="false">3D View</button>
            </div>
          </div>

          <div class="media">
            <div class="pane active" data-pane="image" role="tabpanel">
              <div class="mediaInner">
                <img class="hero" alt="Product image" />
              </div>
            </div>

            <div class="pane" data-pane="3d" role="tabpanel">
              <div class="mediaInner">
                <model-viewer
                  class="mv"
                  camera-controls
                  disable-pan
                  interaction-prompt="none"
                  loading="eager"
                  reveal="auto"
                  exposure="1"
                  field-of-view="30deg"
                ></model-viewer>

                <div class="handHint show" aria-hidden="true">
                  <svg viewBox="0 0 64 64" fill="none">
                    <path d="M26 30V18c0-3 2-5 5-5s5 2 5 5v12" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M36 30V22c0-3 2-5 5-5s5 2 5 5v16c0 9-7 16-16 16s-16-7-16-16v-6"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M22 33l-4-4c-2-2-5-2-7 0s-2 5 0 7l11 11"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 20c4-6 11-10 22-10s18 4 22 10" stroke="#111" stroke-opacity=".25" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="content">
            <div class="title js-title">President Two</div>
            <div class="specs">
              <div><b>Platform</b> <span>3.05m / 10’</span></div>
              <div><b>Power</b> <span>2.2kW / 3HP</span></div>
            </div>
            <div class="btnRow">
              <button class="btn" type="button">CAD</button>
              <button class="btn" type="button">Spec</button>
              <button class="btn btnPrimary" type="button">Build your quote</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Turbo Series: 1 card full width -->
    <section class="series">
      <div class="seriesHeader">
        <div>
          <h2 class="seriesTitle">Turbo Series</h2>
          <p class="seriesSub">1 card · full width</p>
        </div>
      </div>

      <div class="cardsGrid cardsGrid--one">
        <div class="card product-card" data-title="Turbo" data-image="./image.png" data-glb="./PresidentLux_Test2.glb">
          <div class="tabsRow">
            <div class="tabs" role="tablist" aria-label="Media tabs">
              <button class="tabBtn active" type="button" data-tab="image" aria-selected="true">Image</button>
              <button class="tabBtn" type="button" data-tab="3d" aria-selected="false">3D View</button>
            </div>
          </div>

          <div class="media">
            <div class="pane active" data-pane="image" role="tabpanel">
              <div class="mediaInner">
                <img class="hero" alt="Product image" />
              </div>
            </div>

            <div class="pane" data-pane="3d" role="tabpanel">
              <div class="mediaInner">
                <model-viewer
                  class="mv"
                  camera-controls
                  disable-pan
                  interaction-prompt="none"
                  loading="eager"
                  reveal="auto"
                  exposure="1"
                  field-of-view="30deg"
                ></model-viewer>

                <div class="handHint show" aria-hidden="true">
                  <svg viewBox="0 0 64 64" fill="none">
                    <path d="M26 30V18c0-3 2-5 5-5s5 2 5 5v12" stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M36 30V22c0-3 2-5 5-5s5 2 5 5v16c0 9-7 16-16 16s-16-7-16-16v-6"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round"/>
                    <path d="M22 33l-4-4c-2-2-5-2-7 0s-2 5 0 7l11 11"
                          stroke="#111" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 20c4-6 11-10 22-10s18 4 22 10" stroke="#111" stroke-opacity=".25" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="content">
            <div class="title js-title">Turbo</div>
            <div class="specs">
              <div><b>Platform</b> <span>3.05m / 10’</span></div>
              <div><b>Power</b> <span>2.2kW / 3HP</span></div>
            </div>
            <div class="btnRow">
              <button class="btn" type="button">CAD</button>
              <button class="btn" type="button">Spec</button>
              <button class="btn btnPrimary" type="button">Build your quote</button>
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <script>
  (() => {
    // 3D tuning
    const START_AZ = -22;   // 3/4 к зрителю
    const POLAR = 78;       // лёгкий наклон сверху (платформа "к зрителю")
    const LIMIT = 85;       // не показывать заднюю часть
    const AMP = 10;         // амплитуда демо
    const SPEED = 0.00055;  // скорость демо

    const qs = (root, sel) => root.querySelector(sel);

    function stop3dDemo(card) {
      const state = card.__mvState;
      if (!state) return;
      state.autoActive = false;
      if (state.raf) cancelAnimationFrame(state.raf);
      state.raf = null;

      const hand = qs(card, '.handHint');
      if (hand) { hand.classList.add('hide'); hand.classList.remove('show'); }
    }

    function start3dIfNeeded(card) {
      const pane3d = qs(card, '.pane[data-pane="3d"]');
      if (!pane3d || !pane3d.classList.contains('active')) return;

      const mv = qs(card, 'model-viewer.mv');
      if (!mv) return;

      // ensure src set
      const glb = card.getAttribute('data-glb');
      if (glb && !mv.getAttribute('src')) mv.setAttribute('src', glb);

      // frame once per open
      if (card.__mvState && card.__mvState.framed) return;

      const run = () => frameAndDemo(card);

      if (mv.modelIsVisible) run();
      else {
        const onLoad = () => {
          mv.removeEventListener('load', onLoad);
          run();
        };
        mv.addEventListener('load', onLoad);
      }
    }

    function frameAndDemo(card) {
      const mv = qs(card, 'model-viewer.mv');
      const hand = qs(card, '.handHint');
      if (!mv) return;

      if (!card.__mvState) card.__mvState = { autoActive: true, raf: null, framed: false, interacted: false, listenersAdded: false };
      const state = card.__mvState;

      state.framed = true;
      state.autoActive = true;

      if (hand && !state.interacted) { hand.classList.add('show'); hand.classList.remove('hide'); }

      // stop on interaction (once)
      if (!state.listenersAdded) {
        const stop = () => {
          state.interacted = true;
          state.autoActive = false;
          if (state.raf) cancelAnimationFrame(state.raf);
          state.raf = null;
          if (hand) { hand.classList.add('hide'); hand.classList.remove('show'); }

          mv.removeEventListener('pointerdown', stop);
          mv.removeEventListener('touchstart', stop);
          mv.removeEventListener('mousedown', stop);
          mv.removeEventListener('wheel', stop);
          window.removeEventListener('keydown', stop);
        };

        mv.addEventListener('pointerdown', stop);
        mv.addEventListener('touchstart', stop, { passive: true });
        mv.addEventListener('mousedown', stop);
        mv.addEventListener('wheel', stop);
        window.addEventListener('keydown', stop);

        state.listenersAdded = true;
      }

      // auto frame camera
      const c = mv.getBoundingBoxCenter();
      const s = mv.getDimensions();

      const targetY = c.y + (s.y * 0.12);
      mv.cameraTarget = `${c.x}m ${targetY}m ${c.z}m`;

      const rect = mv.getBoundingClientRect();
      const aspect = Math.max(0.2, rect.width / Math.max(1, rect.height));

      const fovDeg = 30;
      const vFov = (fovDeg * Math.PI) / 180;
      const hFov = 2 * Math.atan(Math.tan(vFov / 2) * aspect);

      const pad = 1.30;
      const maxH = Math.max(s.x, s.z);

      const distByWidth  = (maxH * pad) / (2 * Math.tan(hFov / 2));
      const distByHeight = (s.y  * pad) / (2 * Math.tan(vFov / 2));
      const baseDist = Math.max(distByWidth, distByHeight);

      // pinch zoom range
      const minDist = baseDist * 0.65;
      const maxDist = baseDist * 1.80;

      mv.minCameraOrbit = `${START_AZ - LIMIT}deg ${POLAR}deg ${minDist}m`;
      mv.maxCameraOrbit = `${START_AZ + LIMIT}deg ${POLAR}deg ${maxDist}m`;

      mv.cameraOrbit = `${START_AZ}deg ${POLAR}deg ${baseDist}m`;

      if (state.interacted) return;

      let t0 = null;
      const loop = (ts) => {
        if (!state.autoActive) return;
        if (!t0) t0 = ts;
        const t = (ts - t0) * SPEED;
        const az = START_AZ + Math.sin(t) * AMP;
        mv.cameraOrbit = `${az}deg ${POLAR}deg ${baseDist}m`;
        state.raf = requestAnimationFrame(loop);
      };

      if (state.raf) cancelAnimationFrame(state.raf);
      state.raf = requestAnimationFrame(loop);
    }

    function setTab(card, mode) {
      const is3d = mode === '3d';

      const btnImg = qs(card, '.tabBtn[data-tab="image"]');
      const btn3d  = qs(card, '.tabBtn[data-tab="3d"]');
      if (btnImg && btn3d) {
        btnImg.classList.toggle('active', !is3d);
        btn3d.classList.toggle('active', is3d);
        btnImg.setAttribute('aria-selected', String(!is3d));
        btn3d.setAttribute('aria-selected', String(is3d));
      }

      const paneImg = qs(card, '.pane[data-pane="image"]');
      const pane3d  = qs(card, '.pane[data-pane="3d"]');
      if (paneImg && pane3d) {
        paneImg.classList.toggle('active', !is3d);
        pane3d.classList.toggle('active', is3d);
      }

      if (!is3d) stop3dDemo(card);
      else {
        if (card.__mvState) card.__mvState.framed = false; // reframe on open
        start3dIfNeeded(card);
      }
    }

    function initCard(card) {
      const title = card.getAttribute('data-title');
      const titleEl = qs(card, '.js-title');
      if (title && titleEl) titleEl.textContent = title;

      const img = qs(card, 'img.hero');
      const imageSrc = card.getAttribute('data-image');
      if (img && imageSrc) img.setAttribute('src', imageSrc);

      const mv = qs(card, 'model-viewer.mv');
      const glb = card.getAttribute('data-glb');
      if (mv && glb) mv.setAttribute('src', glb);

      const btnImg = qs(card, '.tabBtn[data-tab="image"]');
      const btn3d = qs(card, '.tabBtn[data-tab="3d"]');

      if (btnImg) btnImg.addEventListener('click', () => setTab(card, 'image'));
      if (btn3d) btn3d.addEventListener('click', () => setTab(card, '3d'));

      setTab(card, 'image');
    }

    // init all cards
    document.querySelectorAll('.product-card').forEach(initCard);

    // reframe on resize for visible 3D panes
    window.addEventListener('resize', () => {
      document.querySelectorAll('.product-card').forEach(card => {
        const pane3d = qs(card, '.pane[data-pane="3d"]');
        if (pane3d && pane3d.classList.contains('active')) {
          if (card.__mvState) card.__mvState.framed = false;
          start3dIfNeeded(card);
        }
      });
    });
  })();
  </script>

</body>
</html>
